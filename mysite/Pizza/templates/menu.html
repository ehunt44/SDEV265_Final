{% extends 'base.html' %}
{% load static %}

{%block content %}

<section class="featured-products">
    <div class="container">
      <h2>Featured Products</h2>
      <div class="product-grid">
        {% for item in ItemList %}
          <div class="product">
            <img src="{% static 'Pizza/Menu/' %}{{ item.filename }}" alt="{{ item.name }}">
            <h3>{{item.name}} - ${{item.price}} - {{item.calories}} calories</h3>
            <div style="background-color: #eee; border-radius: 10px; padding: 0.8rem; height: 31%; margin-bottom: 2rem;">
              <p>{{item.description}}</p>
              {% for topping in item.toppings.all %}
                <input type="checkbox" name="{{item.pk}}topping" id="{{item.pk}}topping{{topping.pk}}" value="{{topping.pk}}">
                <label for="{{item.pk}}topping{{topping.pk}}">{{ topping.name }} - {{topping.calories}} Cal.</label><br>
              {% endfor %}
              <button onclick="addToCart('{{ item.name }}', {{ item.price }}, {{item.pk}})">Add to Cart</button>

            </div>
          </div>
        {% endfor %}
      </div>
    </div>

</section>
  
  <script>
    function addToCart(productName, price, itemId) {

      const checkboxes = document.querySelectorAll(`input[name="${itemId}topping"]`);

      const selectedToppings = [];
      checkboxes.forEach((checkbox) => {
        if (checkbox.checked) {
          const toppingName = document.querySelector(`label[for="${checkbox.id}"]`).innerText;
          selectedToppings.push(toppingName);
        }
      });



      let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
      
      const product = {
        cartId: cartItems.length + 1,
        itemPK: itemId,
        name: productName,
        price: price,
        toppings: selectedToppings
      };
      
      cartItems.push(product);

      localStorage.setItem('cartItems', JSON.stringify(cartItems));
      
      alert(`Added ${productName} ${selectedToppings} the cart.`);
    }
  </script>
{% endblock %}
