{% extends 'base.html' %}

{%block content %}


  <section class="cart">
    <div class="container">
      <h2>Cart</h2>
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody id="cartItems"></tbody>
      </table>
      <div>
        <button onclick="redirectToCheckout()" class="toCheckout">Checkout</button>
      </div>
    </div>
  </section>


<script>
  let cartItems = localStorage.getItem('cartItems') || '[]';
  cartItems = JSON.parse(cartItems);

  function renderCartItems() {
    const cartItemsContainer = document.getElementById('cartItems');
    cartItemsContainer.innerHTML = '';
    cartItems.forEach(item => {

      const row = document.createElement('tr');
      const productName = document.createElement('td');
      const productPrice = document.createElement('td');

      row.setAttribute("id", item.cartId);

      var toppingsList = ``;
      item.toppings.forEach(top => {
        toppingsList += `- ${top} <br/>`;
      });



      productName.innerHTML = `<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%;"> <div style="display: flex; flex-direction: column;">${item.name} <br/> <div class="extras"><i>${toppingsList}</i></div></div> <div style="display: flex; align-items: center;"><button id="${item.cartId}" style="float: right; background-color: #eee; border: 1px solid #D6D6D6;" onclick="removeItem(${item.cartId})"> üóëÔ∏è  </button></div></div>`;





      productPrice.textContent = `$${item.price.toFixed(2)}`;

      row.appendChild(productName);
      row.appendChild(productPrice);
      cartItemsContainer.appendChild(row);
    });
  }

    function removeItem(id){
      var row = document.getElementById(id).remove();
      cartIndex = cartItems.indexOf({cartId: id})
      cartItems.splice(cartIndex - 1, 1)
      localStorage.setItem('cartItems', JSON.stringify(cartItems));
    }


  function redirectToCheckout() {
    //localStorage.removeItem('cartItems');
    window.location.href = "{% url 'checkout' %}"; // Redirect to the checkout page
  }

  function renderReceipt() {
    const receiptItemsContainer = document.getElementById('receiptItems');
    receiptItemsContainer.innerHTML = '';

    const heading = document.createElement('h3');
    heading.textContent = 'Thank you for your purchase!';
    receiptItemsContainer.appendChild(heading);

    const list = document.createElement('ul');
    cartItems.forEach(item => {
      const listItem = document.createElement('li');
      listItem.textContent = `${item.name} - $${item.price.toFixed(2)}`;
      list.appendChild(listItem);
    });

    receiptItemsContainer.appendChild(list);

    cartItems = [];
    renderCartItems();
  }

  renderCartItems();
</script>




{% endblock %}
